{
    "id": "https://metriql.com/schema/report-options/funnel.json",
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "Funnel Recipe Query",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "steps": {
        "type": "array",
        "items": {
          "$ref": "#/definitions/RecipeDataset"
        }
      },
      "excludedSteps": {
        "type": "array",
        "items": {
          "$ref": "#/definitions/ExcludedStep"
        }
      },
      "dimension": {
        "$ref": "#/definitions/FunnelDimension"
      },
      "window": {
        "$ref": "#/definitions/FunnelWindow"
      },
      "connector": {
        "type": "string"
      },
      "strictlyOrdered": {
        "type": "boolean"
      },
      "approximate": {
        "type": "boolean"
      },
      "defaultDateRange": {
        "type": "integer"
      }
    },
    "required": [
      "steps"
    ],
    "definitions": {
      "RecipeDataset": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "dataset": {
            "type": "string"
          },
          "filters": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/FilterReference"
            }
          }
        },
        "required": [
          "dataset"
        ]
      },
      "FilterReference": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "dimension": {},
          "measure": {
            "type": "string"
          },
          "mapping": {
            "type": "string"
          },
          "operator": {
            "type": "string"
          },
          "value": {}
        },
        "oneOf": [
          {"required": ["measure"]},
          {"required": ["mapping"]},
          {"required": ["dimension"]}
        ],
        "required": [
          "operator"
        ]
      },
      "ExcludedStep": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "start": {
            "type": "integer"
          },
          "step": {
            "$ref": "#/definitions/RecipeDataset"
          }
        },
        "required": [
          "step"
        ]
      },
      "FunnelDimension": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "step": {
            "type": "integer"
          },
          "dimension": {}
        },
        "required": [
          "step",
          "dimension"
        ]
      },
      "FunnelWindow": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "value": {
            "type": "integer"
          },
          "type": {}
        },
        "required": [
          "value",
          "type"
        ]
      }
    }
  }