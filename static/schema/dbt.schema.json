{
    "$schema":"http://json-schema.org/draft-07/schema#",
    "title":"dbt resource",
    "description":"the schema of dbt resource files defined as *.yml",
    "type":"object",
    "additionalProperties":false,
    "definitions":{
       "freshness":{
          "type":"object",
          "properties":{
             "warn_after":{
                "type":"object",
                "required":[
                   "count",
                   "period"
                ],
                "properties":{
                   "count":{
                      "type":"integer",
                      "default":12
                   },
                   "period":{
                      "type":"string",
                      "default":"hour"
                   }
                }
             },
             "error_after":{
                "type":"object",
                "required":[
                   "count",
                   "period"
                ],
                "properties":{
                   "count":{
                      "type":"integer",
                      "default":24
                   },
                   "period":{
                      "type":"string",
                      "default":"hour"
                   }
                }
             }
          }
       },
       "column":{
          "type":"object",
          "required":[
             "name"
          ],
          "additionalProperties":false,
          "properties":{
             "name":{
                "type":"string"
             },
             "description":{
                "type":"string"
             },
             "quote":{
                "type":"boolean"
             },
             "tests":{
                "type":[
                   "null",
                   "array"
                ],
                "items":{
                   "anyOf":[
                      {
                         "type":"string",
                         "examples":[
                            "unique",
                            "not_null"
                         ]
                      },
                      {
                         "const":"accepted_values",
                         "additionalProperties":{
                            "values":{
                               "type":"array"
                            }
                         }
                      },
                      {
                         "type":"object",
                         "properties":{
                            "relationship":{
                               "properties":{
                                  "to":{
                                     "type":"string"
                                  },
                                  "field":{
                                     "type":"string"
                                  },
                                  "metriql": {
                                   "description":{
                                         "type":"string"
                                      },
                                      "label":{
                                         "type":"string"
                                      },
                                      "type":{
                                         "$ref":"https://app.rakam.io/schema/model.schema.json#/definitions/relationType"
                                      },
                                      "relationship":{
                                         "$ref":"https://app.rakam.io/schema/model.schema.json#/definitions/relationship"
                                      }
                                  }
                               }
                            }
                         }
                      },
                      {
                         "type":"object"
                      }
                   ]
                }
             },
             "tags":{
                "type":"array",
                "description":"Set tags for the columns"
             },
             "meta":{
                "type":"object",
                "additionalProperties":true,
                "properties":{
                   "rakam.dimension":{
                      "$ref":"https://app.rakam.io/schema/model.schema.json#/definitions/dimension"
                   },
                   "rakam.measure":{
                      "$ref":"https://app.rakam.io/schema/model.schema.json#/definitions/measure"
                   }
                }
             }
          }
       }
    },
    "properties":{
       "version":{
          "const":2,
          "default":2
       },
       "models":{
          "type":"array",
          "items":{
             "type":"object",
             "required":[
                "name"
             ],
             "additionalProperties":false,
             "properties":{
                "name":{
                   "description":"DBT unique model name",
                   "type":"string"
                },
                "description":{
                   "description":"Markdown string",
                   "type":"string"
                },
                 "docs":{
                               "type":"object",
                               "properties":{
                                  "show":{
                                     "type":"boolean"
                                  }
                               }
                            },
                            "tests":{
                               "type":[
                                  "null",
                                  "array"
                               ]
                            },
                            "columns":{
                               "type":"array",
                               "items":{
                                  "$ref":"#/definitions/column"
                               }
                            },
                "meta":{
                   "type":"object",
                   "additionalProperties":true,
                   "properties":{
                      "metriql":{
                         "$ref":"https://app.rakam.io/schema/dbt.schema.json"
                      }
                   }
                }
             }
 
          }
       },
       "seeds":{
          "type": "array",
          "items": {
             "type": "object",
             "required": ["name"],
             "additionalProperties": true,
             "properties": {
                "name": {
                 "type": "string"
                },
                "meta": {
                                            "properties": {
                                              "metriql": {
                                                "$ref":"https://app.rakam.io/schema/dbt.schema.json"
                                              }
                                            }
                                           },
                                           "columns":{
                                                                         "type":"array",
                                                                         "items":{
                                                                            "$ref":"#/definitions/column"
                                                                         }
                                                                      }
             }
          }
       },
       "sources":{
             "type":"array",
             "items":{
                "type":"object",
                "required":[
                   "name"
                ],
               "additionalProperties":false,
                "properties":{
                   "name":{
                      "type":"string"
                   },
                   "description":{
                      "type":"string"
                   },
                   "database":{
                      "type":"string"
                   },
                   "schema":{
                      "type":"string"
                   },
                   "meta": {
                                               "properties": {
                                                 "metriql": {
                                                   "$ref":"https://app.rakam.io/schema/dbt.schema.json"
                                                 }
                                               }
                                              },
                   "loader":{
                      "type":"string"
                   },
                   "loaded_at_field":{
                      "type":"string"
                   },
                   "quote":{
                      "type":"boolean"
                   },
                   "tests":{
                      "type":[
                         "null",
                         "array"
                      ]
                   },
                   "tags":{
                      "type":"array",
                      "description":"Set tags for the columns",
                      "items":{
                         "type":"string"
                      }
                   },
                   "freshness":{
                      "$ref":"#/definitions/freshness"
                   },
                   "tables":{
                      "type":"array",
                      "items":{
                         "type":"object",
                         "required":[
                            "name"
                         ],
                         "additionalProperties":false,
                         "properties":{
                            "name":{
                               "description":"Source table name ",
                               "type":"string"
                            },
                            "identifier":{
                                              "description":"Source table name ",
                                              "type":"string"
                                           },
                            "meta": {
                             "properties": {
                               "metriql": {
                                 "$ref":"https://app.rakam.io/schema/dbt.schema.json"
                               }
                             }
                            },
                            "description":{
                               "description":"Markdown string",
                               "type":"string"
                            },
                            "tests":{
                               "type":[
                                  "null",
                                  "array"
                               ]
                            },
                            "columns":{
                               "type":"array",
                               "items":{
                                  "$ref":"#/definitions/column"
                               }
                            }
                         }
                      }
                   }
                }
             }
          }
    }
 }